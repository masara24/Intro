<html>
<head>
<meta charset="UTF-8" />
<title>Javascript Highcharts</title>
<script src="https://code.highcharts.com/highcharts.js"></script>
<script src="https://code.highcharts.com/stock/highstock.js"></script>

<script src="https://code.highcharts.com/modules/full-screen.js"></script>
<script src="https://code.highcharts.com/modules/exporting.js"></script>
<script src="https://code.highcharts.com/modules/export-data.js"></script>
<script src="https://code.highcharts.com/modules/accessibility.js"></script>
<script src="https://code.highcharts.com/themes/adaptive.js"></script>

<style>

#container {
    height: 700px;
    min-width: 310px;
    center
}
.highcharts-data-table table {
    min-width: 310px;
    max-width: 800px;
    margin: 1em auto;
}

.highcharts-data-table table {
    font-family: Verdana, sans-serif;
    border-collapse: collapse;
    border: 1px solid var(--highcharts-neutral-color-10, #e6e6e6);
    margin: 10px auto;
    text-align: center;
    width: 100%;
    max-width: 500px;
}

.highcharts-data-table caption {
    padding: 1em 0;
    font-size: 1.2em;
    color: var(--highcharts-neutral-color-60, #666);
}

.highcharts-data-table th {
    font-weight: 600;
    padding: 0.5em;
}

.highcharts-data-table tbody tr:nth-child(even) {
    background: var(--highcharts-neutral-color-3, #f7f7f7);
}
</style>

</head>
<body><center>

<div id="container"></div>


<script language="JavaScript">
const salesData = [1.1098, 1.1441, 1.138, 1.1895, 1.2331, 1.303, 1.2374, 1.2509, 1.216, 1.2086, 1.2374, 1.2065];

function calculateLinearRegression(data) {
    const n = data.length;
    let sumX = 0, sumY = 0, sumXY = 0, sumXX = 0;
    
    // 计算所需的总和
    for (let i = 0; i < n; i++) {
        sumX += i;
        sumY += data[i];
        sumXY += i * data[i];
        sumXX += i * i;
    }
    
    // 计算斜率和截距
    const slope = (n * sumXY - sumX * sumY) / (n * sumXX - sumX * sumX);
    const intercept = (sumY - slope * sumX) / n;
    
    // 生成趋势线数据点
    const trendData = [];
    for (let i = 0; i < n; i++) {
        trendData.push(slope * i + intercept);
    }
    
    return {
        slope: slope,
        intercept: intercept,
        data: trendData
    };
};


//const salesData = [354.5, 358.66, 359.93, 361.15, 356.67, 356.6, 364.48, 365.37, 361.49, 360.45, 362.5, 365.98, 367.84, 355.26, 344.75, 341.56, 333.79, 330.83, 327.74, 321.56, 324.21, 321.58, 327.45, 339.06, 332.52, 321.86, 320.52, 313.58, 309.09, 311.54, 319.97, 319.05, 326.28, 329.71, 329.77, 323.21, 324.54, 339.71, 333.49, 330.91, 323.62, 323.6, 328.37, 336.73, 341.84, 341.1, 334.2, 331.63, 328.14, 327.42, 325.16, 324.8, 327.58, 331.83, 328.94, 332.16, 330.11, 336.4, 342.02, 348.97, 341.7, 346.85, 343.98];
const regression = calculateLinearRegression(salesData);

Highcharts.chart('container', {
    chart: {
        type: 'scatter',
        events: {
            click: function (e) {
                // find the clicked values and the series
                const x = Math.round(e.xAxis[0].value),
                    y = Math.round(e.yAxis[0].value),
                    series = this.series[0];

                // Add it
                series.addPoint([x, y]);

            }
        }
    },
    title: {
        text: 'User supplied data',
        align: 'left'
    },
    subtitle: {
        text: 'Click the plot area to add a point. Click a point to remove it.',
        align: 'left'
    },
    xAxis: {
        gridLineWidth: 1,
        minPadding: 0.2,
        maxPadding: 0.2,
        maxZoom: 60,
        min: 0,
    },
    credits: {
        enabled: false  //去掉hightchats水印
    },
    legend: {
        enabled: false
    },
    exporting: {
        enabled: true
    },
    yAxis: {
        title: {
            text: 'Value'//开出个数
        },
        min: 0,
        minorGridLineWidth: 0,
        gridLineWidth: 0,
        alternateGridColor: null,
        plotBands: [ {
            from: 0,
            to: 1.1098,
            color: 'rgba(0, 0, 0, 0)',
            label: {
                text: '大冷',
                style: {
                    color: '#606060'
                }
            }
        }, {
            from: 1.1098,
            to: 1.14844,
            color: 'rgba(68, 170, 213, 0.1)',
            label: {
                text: '小冷',
                style: {
                    color: '#606060'
                }
            }
        }, {
            from: 1.14844,
            to: 1.18708,
            color: 'rgba(0, 255, 0, 0.1)',
            label: {
                text: '冷',
                style: {
                    color: '#606060'
                }
            }
        }, {
            from: 1.18708,
            to: 1.22572,
            color: 'rgba(255, 215, 0, 0.2)',
            label: {
                text: '热',
                style: {
                    color: '#606060'
                }
            }
        }, {
            from: 1.22572,
            to: 1.26436,
            color: 'rgba(255, 106, 106, 0.3)',
            label: {
                text: '小热',
                style: {
                    color: '#606060'
                }
            }
        }, { 
            from: 1.26436,
            to: 1.303,
            color: 'rgba(255, 49, 49, 0.4)',
            label: {
                text: '大热',
                style: {
                    color: '#606060'
                }
            }
        }]
    },
    tooltip: {
        valueSuffix: '$'
    },
    plotOptions: {
        spline: {
            lineWidth: 4,
            states: {
                hover: {
                    lineWidth: 5
                }
            },
            marker: {
                enabled: false
            },
            pointInterval: 1, // one hour
            pointStart: 1
        },
        series: {
            stickyTracking: false,
            lineWidth: 3,
            point: {
                events: {
                    click: function () {
                        if (this.series.data.length > 1) {
                            this.remove();
                        }
                    }
                }
            }
        }
    },
    series: [{
        name: '价格',
        data: salesData,
        color: '#FF5722',
        lineWidth: 2,
        marker: {
            radius: 4
        }
    }, {
        name: '反转',
        data: regression.data,
        color: '#2196F3',
        lineWidth: 3,
        
        marker: {
            enabled: false
        },
        enableMouseTracking: false
    }]
});


</script></center>

</body>
</html>
